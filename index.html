<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>کانفیگ‌های V2Ray و پروکسی</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
@font-face {
    font-family: 'IRANSans';
    src: url('https://cdn.fontcdn.ir/Font/Persian/IRANSans/IRANSansWeb(FaNum).eot');
    src: url('https://cdn.fontcdn.ir/Font/Persian/IRANSans/IRANSansWeb(FaNum).eot?#iefix') format('embedded-opentype'),
         url('https://cdn.fontcdn.ir/Font/Persian/IRANSans/IRANSansWeb(FaNum).woff2') format('woff2'),
         url('https://cdn.fontcdn.ir/Font/Persian/IRANSans/IRANSansWeb(FaNum).woff') format('woff'),
         url('https://cdn.fontcdn.ir/Font/Persian/IRANSans/IRANSansWeb(FaNum).ttf') format('truetype');
    font-weight: normal; font-style: normal; font-display: swap;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{
    font-family:'IRANSans',Arial,sans-serif;
    background:#0a1126;
    color:#e2e8f0;
    min-height:100vh;
    padding:20px;
}
.container{
    max-width:1200px;
    margin:0 auto;
}
.header{
    text-align:center;
    margin-bottom:20px;
}
.header h1{font-size:2.5rem;color:#fff;margin-bottom:5px;}
.header p{color:#aaa;}
.filters{
    display:flex;gap:10px;flex-wrap:wrap;margin-bottom:20px;justify-content:center;
}
.filters select, .filters button{
    padding:10px 15px;
    border-radius:8px;
    border:none;
    background:rgba(51,65,85,0.7);
    color:#e2e8f0;
    cursor:pointer;
    border:1px solid rgba(59,130,246,0.3);
    transition:all 0.3s;
}
.filters select:hover, .filters button:hover{
    background:rgba(59,130,246,0.7);
}
.stats{
    display:flex;gap:15px;flex-wrap:wrap;justify-content:center;margin-bottom:20px;
}
.stat-item{
    background:rgba(51,65,85,0.5);
    padding:15px;
    border-radius:8px;
    text-align:center;
    min-width:130px;
    border:1px solid rgba(59,130,246,0.2);
}
.stat-item .number{font-size:1.5rem;color:#3b82f6;font-weight:bold;margin-bottom:3px;}
.configs-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:15px;}
.config-card{
    background:rgba(30,41,59,0.8);
    padding:15px;
    border-radius:10px;
    border:1px solid rgba(59,130,246,0.3);
    position:relative;
    transition:all 0.3s;
}
.config-card:hover{transform:translateY(-5px);border-color:#8b5cf6;}
.protocol-badge{
    position:absolute;
    top:10px; left:10px;
    padding:5px 10px;
    border-radius:5px;
    font-size:0.8rem;
    font-weight:bold;
}
.protocol-vmess{background:rgba(139,92,246,0.2);color:#8b5cf6;}
.protocol-vless{background:rgba(59,130,246,0.2);color:#3b82f6;}
.protocol-trojan{background:rgba(6,182,212,0.2);color:#06b6d4;}
.protocol-hysteria{background:rgba(236,72,153,0.2);color:#ec4899;}
.protocol-wireguard{background:rgba(34,197,94,0.2);color:#22c55e;}
.protocol-shadowsocks{background:rgba(249,115,22,0.2);color:#f97316;}
.config-info p{margin:5px 0;display:flex;align-items:center;gap:6px;}
.config-actions{display:flex;gap:10px;margin-top:10px;}
.config-actions button{
    flex:1;padding:6px 10px;border:none;border-radius:5px;background:linear-gradient(135deg,#06b6d4 0%,#3b82f6 100%);color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:5px;transition:all 0.3s;
}
.config-actions button:hover{background:linear-gradient(135deg,#3b82f6 0%,#8b5cf6 100%);}
.notification{
    position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:rgba(30,41,59,0.9);color:white;padding:12px 20px;border-radius:8px;display:flex;align-items:center;gap:10px;opacity:0;transition:0.3s;z-index:1000;border:1px solid rgba(59,130,246,0.3);
}
.notification.show{opacity:1;}
.pagination{display:flex;justify-content:center;gap:5px;margin:20px 0;}
.pagination button{padding:5px 10px;background:rgba(51,65,85,0.7);border:none;border-radius:5px;color:#e2e8f0;cursor:pointer;transition:0.3s;}
.pagination button.active, .pagination button:hover{background:#3b82f6;}
.loading{text-align:center;padding:40px;color:#3b82f6;}
.loading i{font-size:2rem;margin-bottom:10px;animation:spin 1s infinite linear;}
@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
</style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>کانفیگ‌های V2Ray و پروکسی</h1>
        <p>جمع‌آوری و دسته‌بندی پروتکل‌ها با لوکیشن و صفحه‌بندی</p>
    </div>

    <div class="stats">
        <div class="stat-item"><div class="number" id="totalConfigs">0</div>کل کانفیگ‌ها</div>
        <div class="stat-item"><div class="number" id="vmessCount">0</div>VMess</div>
        <div class="stat-item"><div class="number" id="vlessCount">0</div>VLESS</div>
        <div class="stat-item"><div class="number" id="trojanCount">0</div>Trojan</div>
        <div class="stat-item"><div class="number" id="hysteriaCount">0</div>Hysteria</div>
        <div class="stat-item"><div class="number" id="wireguardCount">0</div>WireGuard</div>
        <div class="stat-item"><div class="number" id="ssCount">0</div>Shadowsocks</div>
    </div>

    <div class="filters">
        <select id="protocolFilter">
            <option value="all">همه پروتکل‌ها</option>
            <option value="vmess">VMess</option>
            <option value="vless">VLESS</option>
            <option value="trojan">Trojan</option>
            <option value="hysteria">Hysteria</option>
            <option value="wireguard">WireGuard</option>
            <option value="shadowsocks">Shadowsocks</option>
        </select>

        <select id="countryFilter">
            <option value="all">همه کشورها</option>
        </select>

        <button onclick="loadConfigs()"><i class="fas fa-sync-alt"></i> بروزرسانی</button>
        <button onclick="copyAllConfigs()"><i class="fas fa-copy"></i> کپی همه</button>
    </div>

    <div id="configsContainer">
        <div class="loading"><i class="fas fa-spinner"></i><p>در حال دریافت کانفیگ‌ها...</p></div>
    </div>

    <div class="pagination" id="pagination"></div>
</div>

<div class="notification" id="notification"><i class="fas fa-check-circle"></i><span id="notificationText"></span></div>

<script>
let allConfigs=[],currentPage=1,configsPerPage=20;
let geoCache={}; // ذخیره GeoIP

function showNotification(msg){
    const n=document.getElementById('notification');
    document.getElementById('notificationText').textContent=msg;
    n.classList.add('show');
    setTimeout(()=>{n.classList.remove('show');},3000);
}
function copyToClipboard(text){
    navigator.clipboard.writeText(text).then(()=>{showNotification('متن با موفقیت کپی شد!');})
    .catch(()=>{showNotification('خطا در کپی متن!');});
}

// تابع دریافت GeoIP ساده با API رایگان
async function getCountry(ip){
    if(!ip) return "نامشخص";
    if(geoCache[ip]) return geoCache[ip];
    try{
        const res=await fetch(`https://ipapi.co/${ip}/country_name/`);
        if(res.ok){const country=await res.text(); geoCache[ip]=country; return country;}
    }catch(e){}
    return "نامشخص";
}

// parse کانفیگ‌ها
function parseConfigs(text){
    const configs=[];
    const lines=text.split('\n');
    const patterns=[
        {regex:/vmess:\/\/([^\s]+)/gi,type:'vmess'},
        {regex:/vless:\/\/([^\s]+)/gi,type:'vless'},
        {regex:/trojan:\/\/([^\s]+)/gi,type:'trojan'},
        {regex:/hysteria2?:\/\/([^\s]+)/gi,type:'hysteria'},
        {regex:/wg:\/\/([^\s]+)/gi,type:'wireguard'},
        {regex:/ss:\/\/([^\s]+)/gi,type:'shadowsocks'}
    ];
    lines.forEach(line=>{
        line=line.trim();
        patterns.forEach(p=>{
            let m;
            while((m=p.regex.exec(line))!==null){
                configs.push({protocol:p.type,link:m[0],raw:line});
            }
        });
    });
    return configs;
}

// آمار
function updateStats(){
    document.getElementById('totalConfigs').textContent=allConfigs.length;
    document.getElementById('vmessCount').textContent=allConfigs.filter(c=>c.protocol==='vmess').length;
    document.getElementById('vlessCount').textContent=allConfigs.filter(c=>c.protocol==='vless').length;
    document.getElementById('trojanCount').textContent=allConfigs.filter(c=>c.protocol==='trojan').length;
    document.getElementById('hysteriaCount').textContent=allConfigs.filter(c=>c.protocol==='hysteria').length;
    document.getElementById('wireguardCount').textContent=allConfigs.filter(c=>c.protocol==='wireguard').length;
    document.getElementById('ssCount').textContent=allConfigs.filter(c=>c.protocol==='shadowsocks').length;
}

// رندر صفحه
async function renderConfigs(){
    const protocolFilter=document.getElementById('protocolFilter').value;
    const countryFilter=document.getElementById('countryFilter').value;
    let filtered=allConfigs;
    if(protocolFilter!=='all') filtered=filtered.filter(c=>c.protocol===protocolFilter);
    if(countryFilter!=='all') filtered=filtered.filter(c=>c.country===countryFilter);

    const totalPages=Math.ceil(filtered.length/configsPerPage);
    if(currentPage>totalPages) currentPage=1;
    const start=(currentPage-1)*configsPerPage;
    const pageConfigs=filtered.slice(start,start+configsPerPage);

    const container=document.getElementById('configsContainer');
    if(pageConfigs.length===0){
        container.innerHTML=`<div style="text-align:center;padding:40px;color:#aaa;"><i class="fas fa-info-circle" style="font-size:3rem;"></i><p>هیچ کانفیگی یافت نشد</p></div>`;
        document.getElementById('pagination').innerHTML='';
        return;
    }

    let html='<div class="configs-list">';
    for(const cfg of pageConfigs){
        const shortLink=cfg.link.length>60?cfg.link.substr(0,60)+'...':cfg.link;
        const protocolClass='protocol-'+cfg.protocol;
        const country=cfg.country||"در حال دریافت...";
        html+=`
        <div class="config-card">
            <span class="protocol-badge ${protocolClass}">${cfg.protocol.toUpperCase()}</span>
            <div class="config-info">
                <p><i class="fas fa-link"></i> ${shortLink}</p>
                <p><i class="fas fa-globe"></i> ${country}</p>
            </div>
            <div class="config-actions">
                <button onclick="copyToClipboard('${cfg.link.replace(/'/g,"\\'")}')"><i class="fas fa-copy"></i> کپی</button>
            </div>
        </div>`;
    }
    html+='</div>';
    container.innerHTML=html;

    // صفحه‌بندی
    let pagHtml='';
    for(let i=1;i<=totalPages;i++){
        pagHtml+=`<button class="${i===currentPage?'active':''}" onclick="goPage(${i})">${i}</button>`;
    }
    document.getElementById('pagination').innerHTML=pagHtml;
}

// تغییر صفحه
function goPage(n){currentPage=n;renderConfigs();}

// کپی همه
function copyAllConfigs(){
    if(allConfigs.length===0){showNotification('هیچ کانفیگی وجود ندارد');return;}
    const allLinks=allConfigs.map(c=>c.link).join('\n');
    copyToClipboard(allLinks);
}

// بارگذاری کانفیگ‌ها
async function loadConfigs(){
    const container=document.getElementById('configsContainer');
    container.innerHTML=`<div class="loading"><i class="fas fa-spinner"></i><p>در حال دریافت کانفیگ‌ها...</p></div>`;
    try{
        const urls=[
            "https://raw.githubusercontent.com/miladtahanian/multi-proxy-config-fetcher/refs/heads/main/configs/proxy_configs.txt",
            "https://raw.githubusercontent.com/miladtahanian/V2RayCFGDumper/refs/heads/main/config.txt",
            "https://raw.githubusercontent.com/10ium/V2Hub3/refs/heads/main/merged"
        ]; // اینجا میتونی بقیه لینک‌ها اضافه کنی

        let texts='';
        for(const u of urls){
            const res=await fetch(u);
            if(res.ok) texts+=await res.text()+'\n';
        }

        allConfigs=parseConfigs(texts);
        // گرفتن لوکیشن همه کانفیگ‌ها
        for(const cfg of allConfigs){
            let ipMatch=cfg.link.match(/(\d{1,3}\.){3}\d{1,3}/);
            const ip=ipMatch?ipMatch[0]:null;
            cfg.country=await getCountry(ip);
        }

        // پر کردن لیست کشورها
        const countries=[...new Set(allConfigs.map(c=>c.country))].sort();
        const countryFilter=document.getElementById('countryFilter');
        countryFilter.innerHTML='<option value="all">همه کشورها</option>';
        countries.forEach(c=>{const o=document.createElement('option');o.value=c;o.textContent=c;countryFilter.appendChild(o);});

        updateStats();
        renderConfigs();
        showNotification(`تعداد ${allConfigs.length} کانفیگ دریافت شد ✅`);

    }catch(e){
        console.error(e);
        container.innerHTML=`<div style="text-align:center;padding:40px;color:#f00;"><i class="fas fa-exclamation-triangle" style="font-size:3rem;"></i><p>خطا در دریافت کانفیگ‌ها</p></div>`;
        showNotification('⚠️ خطا در دریافت کانفیگ‌ها');
    }
}

document.addEventListener('DOMContentLoaded',()=>{
    loadConfigs();
    document.getElementById('protocolFilter').addEventListener('change',()=>{currentPage=1;renderConfigs();});
    document.getElementById('countryFilter').addEventListener('change',()=>{currentPage=1;renderConfigs();});
});
</script>
</body>
</html>
