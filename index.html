<!doctype html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§ (Ø¨Ø¯ÙˆÙ† VMess) â€” Optimized</title>
<style>
:root{
  --bg:#0b1220; --card:#0f1724; --muted:#9aa6b2; --accent:#38bdf8; --accent2:#7c3aed;
}
*{box-sizing:border-box}
body{margin:0;font-family:Tahoma, "IRANSans", Arial; background:linear-gradient(180deg,var(--bg),#071021); color:#e6eef6}
.container{max-width:1200px;margin:18px auto;padding:16px}
.header{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between;margin-bottom:14px}
.controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
select,input[type=search]{background:#0c1624;border:1px solid rgba(255,255,255,0.03);color:#e6eef6;padding:8px;border-radius:8px}
button.primary{background:linear-gradient(90deg,var(--accent),var(--accent2));border:none;color:#041025;padding:8px 12px;border-radius:8px;cursor:pointer}
.stats{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:12px}
.stat{background:rgba(255,255,255,0.03);padding:10px;border-radius:8px;min-width:120px;text-align:center}
.stat .n{font-weight:700;color:var(--accent);font-size:1.1rem}
#configs{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:12px}
.card{background:var(--card);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.02);display:flex;flex-direction:column;gap:8px;min-height:120px}
.head{display:flex;justify-content:space-between;align-items:center;gap:8px}
.title{font-weight:700;color:#fff}
.badge{padding:6px 10px;border-radius:999px;font-size:12px;font-weight:700}
.badge-vless{background:rgba(59,130,246,0.18);color:#3b82f6}
.badge-trojan{background:rgba(6,182,212,0.12);color:#06b6d4}
.badge-hysteria{background:rgba(236,72,153,0.12);color:#ec4899}
.badge-wg{background:rgba(34,197,94,0.12);color:#22c55e}
.badge-ss{background:rgba(249,115,22,0.12);color:#f97316}
.badge-tuic{background:rgba(59,130,246,0.12);color:#60a5fa}
.meta{color:var(--muted);font-size:13px}
.actions{display:flex;gap:8px;margin-top:auto}
.btn{padding:7px 10px;border-radius:8px;border:none;cursor:pointer;background:#1f2937;color:#e6eef6}
.btn.flat{background:transparent;border:1px solid rgba(255,255,255,0.04)}
.pagination{display:flex;gap:6px;justify-content:center;margin:16px 0;flex-wrap:wrap}
.page-btn{background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--muted);padding:6px 10px;border-radius:8px;cursor:pointer}
.page-btn.active{background:var(--accent2);color:#fff;border-color:transparent}
.loading{padding:30px;text-align:center;color:var(--muted)}
.small{font-size:12px;color:var(--muted)}
.progress{height:8px;background:rgba(255,255,255,0.04);border-radius:6px;overflow:hidden}
.progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2));width:0%}
@media(max-width:720px){
  .head{flex-direction:column;align-items:flex-start;gap:6px}
}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div>
      <h2 style="margin:0">Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§ â€” Ù†Ø³Ø®Ù‡ Ø¨Ù‡ÛŒÙ†Ù‡ (Ø¨Ø¯ÙˆÙ† VMess)</h2>
      <div class="small">Ù¾Ø±ÙˆØªÚ©Ù„â€ŒÙ‡Ø§: VLESS, Trojan, Hysteria, Shadowsocks, WireGuard, Tuic</div>
    </div>

    <div class="controls">
      <select id="protocolFilter">
        <option value="all">Ù‡Ù…Ù‡ Ù¾Ø±ÙˆØªÚ©Ù„â€ŒÙ‡Ø§</option>
        <option value="vless">VLESS</option>
        <option value="trojan">Trojan</option>
        <option value="hysteria">Hysteria</option>
        <option value="wireguard">WireGuard</option>
        <option value="shadowsocks">Shadowsocks</option>
        <option value="tuic">Tuic</option>
      </select>

      <select id="countryFilter"><option value="all">Ù‡Ù…Ù‡ Ú©Ø´ÙˆØ±Ù‡Ø§</option></select>

      <input type="search" id="q" placeholder="Ø¬Ø³ØªØ¬Ùˆ (Ø¢Ø¯Ø±Ø³ØŒ Ø§Ø³Ù…ØŒ...)">

      <button id="reload" class="primary">ğŸ”„ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ</button>
    </div>
  </div>

  <div class="stats" id="stats">
    <div class="stat"><div class="n" id="totalN">0</div><div class="small">Ú©Ù„ Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§</div></div>
    <div class="stat"><div class="n" id="vlessN">0</div><div class="small">VLESS</div></div>
    <div class="stat"><div class="n" id="trojanN">0</div><div class="small">Trojan</div></div>
    <div class="stat"><div class="n" id="hysteriaN">0</div><div class="small">Hysteria</div></div>
    <div class="stat"><div class="n" id="wgN">0</div><div class="small">WireGuard</div></div>
    <div class="stat"><div class="n" id="ssN">0</div><div class="small">Shadowsocks</div></div>
    <div style="margin-left:auto;text-align:left">
      <div class="small">Geo cache: <span id="geoCount">0</span></div>
      <div class="small">DNS cache: <span id="dnsCount">0</span></div>
    </div>
  </div>

  <div id="progressWrap" style="margin-bottom:12px;display:none">
    <div class="progress"><i id="progressBar"></i></div>
    <div class="small" id="progressText" style="margin-top:6px"></div>
  </div>

  <div id="configs"><div class="loading">â³ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ...</div></div>
  <div class="pagination" id="pagination"></div>
</div>

<script>
/* ========== ØªÙ†Ø¸ÛŒÙ…Ø§Øª ========== */
const SOURCES = [
  "https://raw.githubusercontent.com/miladtahanian/multi-proxy-config-fetcher/refs/heads/main/configs/proxy_configs.txt",
  "https://raw.githubusercontent.com/miladtahanian/V2RayCFGDumper/refs/heads/main/config.txt",
  "https://raw.githubusercontent.com/10ium/V2Hub3/refs/heads/main/merged",
  "https://raw.githubusercontent.com/ALIILAPRO/v2rayNG-Config/main/sub.txt",
  "https://raw.githubusercontent.com/mfuu/v2ray/master/v2ray",
  "https://raw.githubusercontent.com/ts-sf/fly/main/v2",
  "https://raw.githubusercontent.com/aiboboxx/v2rayfree/main/v2",
  "https://raw.githubusercontent.com/mahdibland/ShadowsocksAggregator/master/Eternity.txt",
  "https://raw.githubusercontent.com/mahdibland/ShadowsocksAggregator/master/EternityAir.txt",
  "https://raw.githubusercontent.com/mahdibland/SSAggregator/master/sub/sub_merge.txt",
  "https://raw.githubusercontent.com/roosterkid/openproxylist/refs/heads/main/V2RAY_RAW.txt",
  "https://raw.githubusercontent.com/MhdiTaheri/V2rayCollector/main/sub/mix",
  "https://raw.githubusercontent.com/barry-far/V2ray-config/main/All_Configs_base64_Sub.txt",
  "https://raw.githubusercontent.com/mahsanet/MahsaFreeConfig/refs/heads/main/app/sub.txt",
  "https://raw.githubusercontent.com/LalatinaHub/Mineral/refs/heads/master/result/nodes",
  "https://raw.githubusercontent.com/mheidari98/.proxy/refs/heads/main/all",
  "https://raw.githubusercontent.com/miladtahanian/V2RayScrapeByCountry/refs/heads/main/output_configs/Tuic.txt",
  "https://raw.githubusercontent.com/Argh94/V2Ray-Vault/refs/heads/main/data/sub/protocols/hysteria2.txt",
  "https://raw.githubusercontent.com/10ium/V2ray-Config/refs/heads/main/Splitted-By-Protocol/hysteria2.txt",
  "https://raw.githubusercontent.com/10ium/V2ray-Config/refs/heads/main/Splitted-By-Protocol/tuic.txt",
  "https://raw.githubusercontent.com/dream4network/telegram-configs-collector/refs/heads/main/protocols/hysteria",
  "https://raw.githubusercontent.com/MahsaNetConfigTopic/config/refs/heads/main/xray_final.txt",
  "https://raw.githubusercontent.com/roosterkid/openproxylist/refs/heads/main/V2RAY.txt",
  "https://raw.githubusercontent.com/free-nodes/v2rayfree/refs/heads/main/v2",
  "https://raw.githubusercontent.com/ebrasha/free-v2ray-public-list/refs/heads/main/all_extracted_configs.txt"
];

const PAGE_SIZE = 20;
const DNS_CACHE_KEY = "cfg_dns_v1";
const GEO_CACHE_KEY = "cfg_geo_v1";

/* ========== Ú©Ø´â€ŒÙ‡Ø§ ========== */
let dnsCache = JSON.parse(localStorage.getItem(DNS_CACHE_KEY) || "{}");
let geoCache = JSON.parse(localStorage.getItem(GEO_CACHE_KEY) || "{}");

/* ========== ÙˆØ¶Ø¹ÛŒØª Ø¯Ø§Ø®Ù„ÛŒ ========== */
let configs = []; // {id, protocol, raw, host, ip, country, latency}
let currentPage = 1;
let totalProcessed = 0;

/* ========== ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ ========== */

function splitBlocks(text){
  return text.split(/\r?\n\s*\r?\n+/).map(s=>s.trim()).filter(Boolean);
}

function detectProtocol(entry){
  const s = entry.toLowerCase();
  if(/vless:\/\//.test(s)) return "vless";
  if(/trojan:\/\//.test(s)) return "trojan";
  if(/hysteria2?:\/\//.test(s)) return "hysteria";
  if(/(^|\n)\[interface\]/i.test(entry) || /wg:\/\//i.test(s) || (/privatekey=/i.test(s) && /endpoint=/i.test(s))) return "wireguard";
  if(/(^|\s)ss:\/\//.test(s) || /shadowsocks/i.test(s)) return "shadowsocks";
  if(/tuic:\/\//.test(s)) return "tuic";
  return null;
}

function extractHost(entry){
  // vmess removed; we handle others
  // common patterns: @host:port or Endpoint = host:port or host:port
  let m = entry.match(/@([\w\.-]+):\d+/);
  if(m) return m[1];
  m = entry.match(/Endpoint\s*=\s*([\w\.-]+):\d+/i);
  if(m) return m[1];
  m = entry.match(/host=([\w\.-]+)/i);
  if(m) return m[1];
  m = entry.match(/server=([\w\.-]+)/i);
  if(m) return m[1];
  // try find first ipv4
  m = entry.match(/((?:\d{1,3}\.){3}\d{1,3})/);
  if(m) return m[1];
  // try domain-like token
  m = entry.match(/([a-z0-9\.-]+\.[a-z]{2,})/i);
  if(m) return m[1];
  return null;
}

async function dohResolve(host){
  if(!host) return null;
  if(/^(?:\d{1,3}\.){3}\d{1,3}$/.test(host)) return host;
  if(dnsCache[host]) return dnsCache[host];
  try{
    const r = await fetch(`https://dns.google/resolve?name=${encodeURIComponent(host)}&type=A`);
    if(!r.ok) throw new Error("DNS fail");
    const j = await r.json();
    if(j.Answer && j.Answer.length){
      const a = j.Answer.find(x=>/\d+\.\d+\.\d+\.\d+/.test(x.data));
      if(a && a.data){
        dnsCache[host] = a.data;
        localStorage.setItem(DNS_CACHE_KEY, JSON.stringify(dnsCache));
        updateCacheCounts();
        return a.data;
      }
    }
  }catch(e){
    // ignore
  }
  return null;
}

async function geoForIp(ip){
  if(!ip) return "Ù†Ø§Ù…Ø´Ø®Øµ";
  if(geoCache[ip]) return geoCache[ip];
  try{
    // small endpoint returning country_name
    const r = await fetch(`https://ipapi.co/${ip}/country_name/`);
    if(r.ok){
      const c = (await r.text()).trim() || "Ù†Ø§Ù…Ø´Ø®Øµ";
      geoCache[ip] = c;
      localStorage.setItem(GEO_CACHE_KEY, JSON.stringify(geoCache));
      updateCacheCounts();
      return c;
    }
  }catch(e){}
  return "Ù†Ø§Ù…Ø´Ø®Øµ";
}

// measure simple HEAD latency (no-cors); timeout applied
async function measureLatency(host, timeout=2500){
  if(!host) return null;
  const url = `https://${host}/`;
  const start = performance.now();
  try{
    const controller = new AbortController();
    const t = setTimeout(()=>controller.abort(), timeout);
    await fetch(url, {method:'HEAD', mode:'no-cors', signal: controller.signal});
    clearTimeout(t);
    const ms = Math.max(0, Math.round(performance.now() - start));
    return ms + " ms";
  }catch(e){
    return "timeout";
  }
}

function updateCacheCounts(){
  document.getElementById('geoCount').textContent = Object.keys(geoCache).length;
  document.getElementById('dnsCount').textContent = Object.keys(dnsCache).length;
}

/* batch processor */
async function batchProcess(items, worker, concurrency=4){
  const res = [];
  let i = 0;
  async function next(){
    while(i < items.length){
      const idx = i++;
      try{ res[idx] = await worker(items[idx], idx); }catch(e){ res[idx] = null; }
    }
  }
  const runners = [];
  for(let k=0;k<concurrency;k++) runners.push(next());
  await Promise.all(runners);
  return res;
}

/* ========== parsing and loading ========== */

function parseTextToConfigs(text){
  const blocks = splitBlocks(text);
  const out = [];
  let id = configs.length ? configs.length+1 : 1;
  for(const b of blocks){
    // find inline single-line links first
    const inlineRegexes = [
      /vless:\/\/[^\s'"]+/gi,
      /trojan:\/\/[^\s'"]+/gi,
      /hysteria2?:\/\/[^\s'"]+/gi,
      /ss:\/\/[^\s'"]+/gi,
      /wg:\/\/[^\s'"]+/gi,
      /tuic:\/\/[^\s'"]+/gi
    ];
    let foundInline = false;
    for(const rx of inlineRegexes){
      let m;
      while((m = rx.exec(b)) !== null){
        const entry = m[0];
        const proto = detectProtocol(entry) || 'unknown';
        const host = extractHost(entry);
        out.push({id: id++, protocol: proto, raw: entry, host, ip: null, country: "Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª...", latency: null});
        foundInline = true;
      }
    }
    if(!foundInline){
      // treat whole block (useful for wg multi-line)
      const proto = detectProtocol(b);
      if(proto){
        const host = extractHost(b);
        out.push({id: id++, protocol: proto, raw: b, host, ip: null, country: "Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª...", latency: null});
      }
    }
  }
  return out;
}

/* ========== render UI ========== */

function updateStats(){
  document.getElementById('totalN').textContent = configs.length;
  document.getElementById('vlessN').textContent = configs.filter(c=>c.protocol==='vless').length;
  document.getElementById('trojanN').textContent = configs.filter(c=>c.protocol==='trojan').length;
  document.getElementById('hysteriaN').textContent = configs.filter(c=>c.protocol==='hysteria').length;
  document.getElementById('wgN').textContent = configs.filter(c=>c.protocol==='wireguard').length;
  document.getElementById('ssN').textContent = configs.filter(c=>c.protocol==='shadowsocks').length;
  updateCacheCounts();
}

function render(){
  const prot = document.getElementById('protocolFilter').value;
  const country = document.getElementById('countryFilter').value;
  const q = document.getElementById('q').value.trim().toLowerCase();
  let filtered = configs.filter(c => (prot==='all' || c.protocol===prot));
  if(country!=='all') filtered = filtered.filter(c=> (c.country || '').toLowerCase() === country.toLowerCase());
  if(q) filtered = filtered.filter(c => (c.raw||'').toLowerCase().includes(q) || (c.host||'').toLowerCase().includes(q));

  const total = filtered.length;
  const pages = Math.max(1, Math.ceil(total / PAGE_SIZE));
  if(currentPage > pages) currentPage = 1;
  const start = (currentPage-1)*PAGE_SIZE;
  const pageItems = filtered.slice(start, start+PAGE_SIZE);

  const wrap = document.getElementById('configs');
  wrap.innerHTML = '';
  if(pageItems.length === 0){
    wrap.innerHTML = `<div class="loading">Ù‡ÛŒÚ† Ú©Ø§Ù†ÙÛŒÚ¯ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</div>`;
  } else {
    for(const c of pageItems){
      const card = document.createElement('div'); card.className = 'card';
      const head = document.createElement('div'); head.className='head';
      const t = document.createElement('div'); t.className='title'; t.textContent = (c.protocol||'').toUpperCase();
      const badge = document.createElement('div'); badge.className='badge badge-'+(c.protocol==='vless'?'vless':c.protocol==='trojan'?'trojan':c.protocol==='hysteria'?'hysteria':c.protocol==='wireguard'?'wg':c.protocol==='shadowsocks'?'ss':'tuic');
      badge.textContent = c.protocol.toUpperCase();
      head.appendChild(t); head.appendChild(badge);
      const rawDiv = document.createElement('div'); rawDiv.className='meta'; rawDiv.style.whiteSpace='pre-wrap';
      rawDiv.textContent = c.raw.length>250?c.raw.slice(0,250)+' ...':c.raw;
      const hostDiv = document.createElement('div'); hostDiv.className='meta small'; hostDiv.textContent = `Ø¢Ø¯Ø±Ø³: ${c.host || 'Ù†Ø§Ù…Ø´Ø®Øµ'}`;
      const countryDiv = document.createElement('div'); countryDiv.className='meta small'; countryDiv.id = 'ct-'+c.id; countryDiv.textContent = `Ú©Ø´ÙˆØ±: ${c.country||'Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª...'}`;
      const latDiv = document.createElement('div'); latDiv.className='meta small'; latDiv.id = 'lat-'+c.id; latDiv.textContent = `ØªØ§Ø®ÛŒØ±: ${c.latency || '-'}`;

      const actions = document.createElement('div'); actions.className='actions';
      const btnCopy = document.createElement('button'); btnCopy.className='btn'; btnCopy.textContent='Ú©Ù¾ÛŒ'; btnCopy.onclick = ()=>{navigator.clipboard.writeText(c.raw).then(()=>notify('Ú©Ù¾ÛŒ Ø´Ø¯ âœ…'))};
      const btnPing = document.createElement('button'); btnPing.className='btn flat'; btnPing.textContent='ØªØ³Øª ØªØ§Ø®ÛŒØ±'; btnPing.onclick = async ()=>{ btnPing.disabled=true; btnPing.textContent='Ø¯Ø± Ø­Ø§Ù„ ØªØ³Øª...'; const lat = await measureLatency(c.host); c.latency = lat; document.getElementById('lat-'+c.id).textContent = `ØªØ§Ø®ÛŒØ±: ${lat}`; btnPing.disabled=false; btnPing.textContent='ØªØ³Øª ØªØ§Ø®ÛŒØ±'; };
      actions.appendChild(btnCopy); actions.appendChild(btnPing);

      card.appendChild(head); card.appendChild(rawDiv); card.appendChild(hostDiv); card.appendChild(countryDiv); card.appendChild(latDiv); card.appendChild(actions);
      wrap.appendChild(card);
    }
  }

  // pagination
  const pag = document.getElementById('pagination');
  pag.innerHTML = '';
  if(total <= PAGE_SIZE) return;
  for(let i=1;i<=Math.ceil(total/PAGE_SIZE);i++){
    const b = document.createElement('button'); b.className='page-btn' + (i===currentPage?' active':''); b.textContent = i;
    b.onclick = ()=>{ currentPage = i; render(); };
    pag.appendChild(b);
  }

  updateStats();
}

/* ========== main flow: batched fetch, parse, fill geo ========== */

async function loadAll(){
  // UI prepare
  document.getElementById('configs').innerHTML = '<div class="loading">â³ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù…Ù†Ø§Ø¨Ø¹...</div>';
  currentPage = 1; configs = [];

  // fetch sources in small parallel batches (to avoid too many concurrent)
  const batchSize = 4;
  const progressWrap = document.getElementById('progressWrap');
  const progressBar = document.getElementById('progressBar');
  const progressText = document.getElementById('progressText');
  progressWrap.style.display = 'block';
  progressBar.style.width = '0%';
  progressText.textContent = 'Ø´Ø±ÙˆØ¹ Ø¯Ø§Ù†Ù„ÙˆØ¯...';

  for(let i=0;i<SOURCES.length;i+=batchSize){
    const chunk = SOURCES.slice(i,i+batchSize);
    // fetch chunk in parallel
    const promises = chunk.map(u => fetch(u).then(r => r.ok ? r.text() : '').catch(()=>''));
    const results = await Promise.all(promises);
    // parse each result
    for(const txt of results){
      if(!txt) continue;
      const parsed = parseTextToConfigs(txt);
      for(const p of parsed) configs.push(p);
    }
    // update progress
    const pct = Math.min(100, Math.round((i+batchSize)/SOURCES.length*100));
    progressBar.style.width = pct + '%';
    progressText.textContent = `Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ù†Ø§Ø¨Ø¹: ${Math.min(100,pct)}%`;
    await new Promise(r=>setTimeout(r,200)); // small pause to keep UI responsive
  }

  // initial render (without geo)
  render();

  // fill hosts -> ip -> country in background (batched)
  // collect unique hosts
  const hosts = Array.from(new Set(configs.map(c=>c.host).filter(Boolean)));
  progressText.textContent = `Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù„ÙˆÚ©ÛŒØ´Ù† Ø¨Ø±Ø§ÛŒ ${hosts.length} Ù‡Ø§Ø³Øª...`;
  // process hosts in batches with concurrency 5
  await batchProcess(hosts, async (host, idx)=>{
    // resolve IP
    let ip = null;
    if(/^(?:\d{1,3}\.){3}\d{1,3}$/.test(host)) ip = host;
    else ip = await dohResolve(host);
    // get geo
    let country = "Ù†Ø§Ù…Ø´Ø®Øµ";
    if(ip) country = await geoForIp(ip);
    // update configs with this host
    configs.filter(c=>c.host===host).forEach(cc=>{
      cc.ip = ip; cc.country = country;
      // update UI field if visible
      const el = document.getElementById('ct-'+cc.id);
      if(el) el.textContent = `Ú©Ø´ÙˆØ±: ${country}`;
    });
  }, 5);

  // hide progress
  progressWrap.style.display = 'none';
  // populate country filter
  populateCountryFilter();
  render();
  notify('Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ø§Ù…Ù„ Ø´Ø¯ âœ…');
}

function populateCountryFilter(){
  const set = new Set(configs.map(c=>c.country).filter(x=>x && x!=="Ù†Ø§Ù…Ø´Ø®Øµ" && x!=="Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª..."));
  const arr = Array.from(set).sort();
  const sel = document.getElementById('countryFilter');
  sel.innerHTML = '<option value="all">Ù‡Ù…Ù‡ Ú©Ø´ÙˆØ±Ù‡Ø§</option>';
  arr.forEach(a=>{
    const o = document.createElement('option'); o.value = a; o.textContent = a; sel.appendChild(o);
  });
}

/* ========== small UI helpers ========== */
function notify(txt){ const d = document.createElement('div'); d.className='small'; d.style.position='fixed'; d.style.bottom='18px'; d.style.left='50%'; d.style.transform='translateX(-50%)'; d.style.background='rgba(3,7,18,0.8)'; d.style.padding='8px 12px'; d.style.borderRadius='8px'; d.style.zIndex=9999; d.textContent = txt; document.body.appendChild(d); setTimeout(()=>d.remove(),2200); }

/* ========== events ========= */
document.getElementById('reload').addEventListener('click', ()=>{ loadAll(); });
document.getElementById('protocolFilter').addEventListener('change', ()=>{ currentPage=1; render(); });
document.getElementById('countryFilter').addEventListener('change', ()=>{ currentPage=1; render(); });
document.getElementById('q').addEventListener('input', ()=>{ currentPage=1; render(); });

/* ========== startup ========= */
updateCacheCounts();
loadAll();

</script>
</body>
</html>
